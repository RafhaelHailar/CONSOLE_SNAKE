<!DOCTYPE html>
<html>
<head>
    <title>SNAKE GAME IN CONSOLE</title>
    <style>
     body {
        font-family: Arial, sans-serif;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0;
        margin: 0;
        background: radial-gradient(rgba(255, 255, 255,0.8),gray);
     }

     #note {
        font-size: 1.5rem; 
        color: red;
     }
    </style>
</head>
<body>
    
    <div id="note">NOTHING TO SEE HERE OPEN YOUR BROWSER CONSOLE TO PLAY THE GAME</div>
    <script type="text/javascript"> 

        const COOL_ASCII = `
                                          ⢀⣀⣀⣀⣀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⡉⠙⣻⣷⣶⣤⣀⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⡿⠋⠀⠀⠀⠀⢹⣿⣿⡟⠉⠉⠉⢻⡿⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠰⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⣿⣿⣇⠀⠀⠀⠈⠇⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠉⠛⠿⣷⣤⡤⠀⠀⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣿⣿⣿⣿⣿⣶⣦⣤⣤⣀⣀⣀⡀⠉⠀⠀⠀⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡀⠀⠀⠀⠀
                            ⠀⠀⠀⢀⣀⣤⣄⣀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠙⠛⠿⣿⣿⣿⣿⣿⣿⣦⠀⠀⠀
                            ⠀⠀⣰⣿⣿⣿⣿⣿⣷⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣧⠀⠀
                            ⠀⠀⣿⣿⣿⠁⠀⠈⠙⢿⣿⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿⠀⠀
                            ⠀⠀⢿⣿⣿⣆⠀⠀⠀⠀⠈⠛⠿⣿⣶⣦⡤⠴⠀⠀⠀⠀⠀⣸⣿⣿⣿⡿⠀⠀
                            ⠀⠀⠈⢿⣿⣿⣷⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⠃⠀⠀
                            ⠀⠀⠀⠀⠙⢿⣿⣿⣿⣶⣦⣤⣀⣀⡀⠀⠀⠀⣀⣠⣴⣾⣿⣿⣿⡿⠃⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠈⠙⠻⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠋⠀⠀⠀⠀⠀
                            ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠙⠛⠛⠛⠛⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀
       `;

        const INSTRUCTIONS = `
            -TYPE "GAME.start()" to start the game      -TYPE "board.column=<number>" replacing the <number> with a integer to set the column
            -TYPE "GAME.end()" to end the game          -TYPE "board.row=<number>" for row
            
            -TYPE "fps=<number>" to adjust the fps
            
            -TYPE "HEADER.hide()" to hide this
            -TYPE "HEADER.show()" to show this

            * NOTE: AFTER ENTERING THE "GAME.start()" press the window screen (or the website that contains nothing to remove the focus in the console input (so you are not typing anymore to allow reading your keyboard inputs)

            CHEATS:

            -TYPE "foot.eat()" to randomized to position of the food
            -TYPE "snake.addParts(<number>)" to increase the snake tail and also the score


        `;

        console.log(`%c${COOL_ASCII}`,"font-size: 1.5rem;text-shadow: 0 0 20px red");
        console.log("%c --!https://emojicombos.com/snake-ascii-art","font-size: 2rem;margin-left: 51rem");


        const HEADER = {
            shown: true,
            display() {
                if (!this.shown) return;
                console.log(`%c SNAKES`,"font-size: 5rem;font-weight: 800;color:red;");
                console.log(`%c ${INSTRUCTIONS}`,"font-size: 1.2rem"); 
                console.log(`%c HEY MAN IF YOU ARE SENSITIVE TO BLINKING LIGHT DONT CONTINUE! YOU HAVE BEEN WARNED. I AM NOT RESPONSIBLE FOR ANYTHING, BECAREFUL SOLDIER!`,"color:red;font-size: 1.5rem");
                console.log(`%c ---version 0.1`,"font-size:1.1rem;margin-left:100rem");
            },

            show() {
                this.shown = true;
            },

            hide() {
                this.shown = false;
            }
        }
        HEADER.display();
        
        class Board {
            constructor(row,column) {
                this.initial_row = this.row = row;
                this.initial_column = this.column = column;
                this.board = [];

                this.#setUp(); 
            }

            #setUp() {
                /*
                    this one is looks simplier and easier to right
                    but for some reason setting a value in a arbitrary position
                    will fill out the whole column like.
                    _#_ // board[0][1] = "#"
                    _#_
                    _#_
                    new Array(column).fill(new Array(row).fill("_"))
                */
                this.board = [];
                for (let y = 0; y < this.column; y++) {
                    let rows = [];
                    for (let x = 0; x < this.row; x++) {
                       rows.push(" ");
                    }     
                    this.board.push(rows);
                }
            }

            update() {
                if (this.initial_row != this.row ||
                    this.initial_column != this.column) {
                    this.#setUp();
                }

                for (let y = 0;y < this.column;y++) {
                    for (let x = 0;x < this.row;x++) {
                        // for walls 
                        if (x == 0 || y == 0 ||  
                            x == this.row - 1 || y == this.column  - 1)
                            this.board[y][x] = "#"; 
                        else this.board[y][x] = " ";
                    }
                }
                
            }

            draw() {
                console.log("SCORE: " + (snake.length -1 ) * 1000);
                console.log("FPS: " + fps);

                for (let y = 0;y < this.column;y++) {
                    // because it is the same console log is now collapsing I added the y value
                    console.log(this.board[y].join(" ") + " " +  y )
                }

            } 
        } 

        class Structure {
            constructor(x,y,symbol,board) {
                this.initial_x = this.x = x;
                this.initial_y = this.y = y;
                this.symbol = symbol;
                this.board = board;
            }

            position() {
                this.board.board[this.y][this.x] = this.symbol;
            }
        }

        class Snake extends Structure{
            #length;
            constructor(x,y,symbol,tailSymbol,board,food,length = 1) {
                super(x,y,symbol,board);
                
                // request add x and add y is for not changing the add x nor add y when the user make a move, but the display is not yet ready,
                // so user cant to some magic magic like they can switch to oppisite direction.
                this.reqAddX = this.addX = 1;
                this.reqAddY = this.addY = 0;

                this.tailSymbol = tailSymbol;

                this.parts = [[x,y]];
                this.#length = length; 
                
                this.addPart(length - 1);  

                this.food = food;
            }
            
            // change the direction of snake
            // the condition statement is for not allowing the snake move to its opposite direction
            moveTo(addX,addY) {
                if (addX !== this.addX * -1)
                    this.addX = addX;   
                
                if (addY !== this.addY * -1)
                    this.addY = addY;
            }

            requestTo(addX,addY) {
                this.reqAddX = addX;
                this.reqAddY = addY;
            }

            #logic() {
                // if the snake head hit the border, put the snake to the opposite border
                if (this.x === this.board.row - 1) this.x = 1;
                else if (this.x === 0) this.x = this.board.row - 2;

                if (this.y === this.board.column - 1) this.y = 1;
                else if (this.y === 0) this.y = this.board.column - 2;

                if (this.y === this.food.y &&
                    this.x === this.food.x){
                    this.food.eat(); 
                    this.addPart();
                }
                
                let tails = this.parts.slice(2);
                let head = this.parts[0];
                if (this.parts.length > 3 && tails.some(tail => {
                    return tail[0] == this.x &&
                           tail[1] == this.y;
                })) {
                    cancelAnimationFrame(loopId);
                    console.clear();
                    console.log("GAME OVER!");
                }
            }

            addPart(amount = 1) {
                for (let i = 0;i < amount;i++) {
                    let newPart = this.parts[this.parts.length - 1].slice(0);
                    this.parts.push(newPart);
                    
                    this.#length++;
                }
            }

            positionTails() {
                for (let i = this.#length - 1;i > 0;i--) {
                   const [x,y] = this.parts[i];
                   this.board.board[y][x] = this.tailSymbol;
                   const copyParts = this.parts[i - 1].slice(0);
                   this.parts[i] = copyParts;
                }
            }
            
            // only allows the length to be readable
            get length() {
                return this.#length;
            }

            update() {
                this.x += this.addX;
                this.y += this.addY;
                this.parts[0] = [this.x,this.y];

                this.positionTails();
                this.position();

                this.#logic();

                this.moveTo(this.reqAddX,this.reqAddY);
            }
        }

        class Food extends Structure{
            constructor(x,y,symbol,board) {
                super(x,y,symbol,board);
            }

            #randomizedPosition() {
                this.x = getRandom(1,this.board.row - 2);
                this.y = getRandom(1,this.board.column - 2); 
            }
            

            //what is this for if you are going to do all the logic collission in the snake and you have randomizedPosition??
            //- for later I wanna add some cool effects when the snake eat this jumbo hotdog
            eat() {
                this.#randomizedPosition();
            }

            update() {
                this.position();
            }
        }
        
        //--- >>>>>>>>>>> CONSTANS <<<<<<<<<< ---\\
        const board = new Board(40,20);
        const food = new Food(10,10,"+",board);
        const snake = new Snake(5,5,"0","*",board,food);
       
        const GAME = {
            reset() {
                snake.x = snake.initial_x;
                snake.y = snake.initial_y;
                
                food.x = food.initial_x;
                food.y = food.initial_y;

                snake.length = 1;
            },

            stop() {
                cancelAnimationFrame(loopId);
                loopId = undefined;
            },

            start() {
                requestAnimationFrame(update);
            }
        }


        let fps = 2;
        let currentTime = Date.now();

        let loopId;
        
        // controlls
        window.addEventListener("keydown",function(event) {
            switch (event.key) {
                case "w": 
                    snake.requestTo(0,-1);
                    break;
                case "s": 
                    snake.requestTo(0,1);
                    break;
                case "a": 
                    snake.requestTo(-1,0);
                    break;
                case "d": 
                    snake.requestTo(1,0);
                    break;
            }
        });

        //-----------------UTILITIES----------------------//
        /*
         *  @params {int} start
         *  @params {int} end
         *  
         *  @return {int} : start - end (both inclusive)
         *  
        */
        function getRandom(start,end) {
            return start + Math.floor(Math.random() * end); 
        }


        function update() {
            loopId = requestAnimationFrame(update);
    
            let newTime = Date.now();
            const deltaTime = newTime - currentTime;
            // frame per second / second
            if (deltaTime >= (1000 / fps))
                currentTime = newTime;
            else return;

            console.clear();
            
            HEADER.display();

            board.update();
            food.update();
            snake.update();
            board.draw();
            
        }

    </script>
</body>
</html>
